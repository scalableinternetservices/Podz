<p id="notice"><%= notice %></p>


<div class="item_container">
  <h1 class="item_title"><%= @item.title %></h1>

  <div class="item_sub_container">
    <p>
      <strong>Description:</strong>
      <%= @item.description %>
    </p>
    <p>
      <strong>Condition:</strong>
      <%= @item.condition %>
    </p>

    <p>
      <strong>Available:</strong>
      <% if @item.available %>
        Yes
      <% else %>
        No
      <% end %>
    </p>

    <% unless current_user.nil? %>
      <% if @item.available and !item_owned(current_user.id, @item.user_id) %>

        <%= link_to 'Rent',
                    rent_path(item_id: @item),
                    method: :post,
                    data: { confirm: 'Are you sure you want to rent?', item: @item },
                    class: 'primary_button'
        %>

      <% elsif !@item.available and item_rented(current_user.id, @item.id) %>
        <%= link_to 'Check in item',
                    checkin_path(item_id: @item),
                    method: :post,
                    data: { confirm: 'Are you sure you want to check in the item?', item: @item },
                    class: 'primary_button'
        %>
      <% end %>
    <% end %>


    <div class="bottom_buttons">
      <%= link_to 'Edit', edit_item_path(@item) ,class: "primary_button light"%>
      <%= link_to 'Back', items_path ,class: "primary_button light"%>
      <%if  @isPrevRented and !@isPrevReviewed %>
      <button class="primary_button light" data-toggle="collapse" data-target="#review">Write a review</button>
      <% end %>
    </div>

  </div>


</div>

<%if  @isPrevRented and !@isPrevReviewed %>
  <div id="review" class="collapse">
  <div class="review_container">
    <%= render 'reviews/form', review: @review %>
  </div>
  </div>
<% end %>

<hr>

<h2 id="reviews_title">Reviews</h2>

<table class="item_table">
  <% if @reviews.count != 0 %>
  <thead class="table_content">

    <tr class="list_header">

      <div class="text_container">
        <th class="list_item_text">Title</th>
        <th class="list_item_text">Review</th>
        <th class="list_item_text">Rating</th>
        <th class="list_item_text">User</th>
      </div>
    </tr>
  </thead>
  <% else %>
    <div id="no_review_container">
      <h4 id="no_reviews_title">No reviews to show!</h4>
    </div>
  <% end %>

  <tbody class="table_content">

    <% @reviews.each do |review| %>

      <tr class="list_item">
        <div class="text_container">
          <td class="list_item_text"><%= review.title %></td>
          <td class="list_item_text"><%= review.body %></td>
          <td class="list_item_text"><%= review.rating %>/5</td>
          <td class="list_item_text"><%= get_display_name(review) %></td>
        </div>
      </tr>
    <% end %>
  </tbody>
</table>


<h2 id="reviews_title">Rentals</h2>

<table class="item_table">
  <% if @rentals.count != 0 %>
    <thead class="table_content">

    <tr class="list_header">

      <div class="text_container">
        <th class="list_item_text">Name</th>
        <th class="list_item_text">Rental length</th>
        <th class="list_item_text">Check-in date</th>
      </div>
    </tr>
    </thead>
  <% else %>
    <div id="no_review_container">
      <h4 id="no_reviews_title">No rentals to show!</h4>
    </div>
  <% end %>

  <tbody class="table_content">

  <% @rentals.each do |rental| %>

    <tr class="list_item">
      <div class="text_container">
        <td class="list_item_text"><%= display_renter_title(rental) %></td>
        <td class="list_item_text">To be configured</td>
        <td class="list_item_text"><%= rental.check_in_date %></td>
      </div>
    </tr>
  <% end %>
  </tbody>
</table>
